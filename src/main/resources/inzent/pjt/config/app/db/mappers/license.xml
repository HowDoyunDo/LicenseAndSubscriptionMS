<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="license">
	<select id="getLicenseList" parameterType="int" resultType="licensevo">
		<![CDATA[
			select lc.*, sp.policy_title, sp.standard, ol.reg_date
			 from license lc, subscription_policy sp, order_list ol 
			 where lc.policy_no = sp.no 
			 and lc.user_admin_no = #{adminNo}
			 and lc.order_no = ol.no
		]]>
	</select>
	
	<select id="getUserList" parameterType="int" resultType="generaluservo">
		<![CDATA[
			select gu.*, ag.last_login
			 from agent ag, general_user gu
			 where ag.license_no = #{licenseNo}
			 and ag.user_no = gu.no
		]]>
	</select>
	
	<select id="getSearch1" parameterType="map" resultType="generaluservo">
		<![CDATA[
			select gu.*, ag.last_login 
			 from agent ag, general_user gu
			 where ag.license_no = #{licenseNo} 
			 and ag.user_no = gu.no
			 and gu.email like CONCAT('%', #{email}, '%')
			 and gu.name like CONCAT('%', #{name}, '%')
			 and gu.dept_name like CONCAT('%', #{dept}, '%')
			 and last_login between to_timestamp(#{start}, 'YYYY-MM-DD HH24:MI:SS') and to_timestamp(#{end}, 'YYYY-MM-DD HH24:MI:SS')
		]]>
	</select>
	
	<select id="getSearch2" parameterType="map" resultType="generaluservo">
		<![CDATA[
			select gu.*, ag.last_login 
			 from agent ag, general_user gu 
			 where ag.license_no = #{licenseNo} 
			 and ag.user_no = gu.no
			 and gu.email like CONCAT('%', #{email}, '%')
			 and gu.name like CONCAT('%', #{name}, '%')
			 and gu.dept_name like CONCAT('%', #{dept}, '%')
		]]>
	</select>
	
	<delete id="delUser1" parameterType="string">
		<![CDATA[
			delete 
			 from general_user
			 where no in ${_parameter} 
		]]>
	</delete>

	<delete id="delUser2" parameterType="string">
		<![CDATA[
			delete 
			 from agent
			 where user_no in ${_parameter} 
		]]>
	</delete>
	
	<update id="downCurrentCount" parameterType="string">
		<![CDATA[
			update license 
			 set current_count = current_count-1
			 where no = 1;
		]]>
	</update>
	
</mapper>
